<html>
  <head>

  <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 50%; width: 50% }
    </style>

  </head>
  <body>
    <p> Hello {{name}}! </p>

    <div id = "demo">
    </div>
    
    <div id = "map-canvas"> 
    </div>

    <form action = "setprofile" method = "post">
      <input type = "hidden" name = "lat" id = "in_lat" > 
      <input type = "hidden" name = "lng" id = "in_lng">
      <label> Organisation: </label>
      <input type = "text" name = "organisation" id = "organisation">
      <input type = "submit" value = "Submit">
    </form>


    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDuyc3ZQDA3Yah7i5r_i36oi1uQH5KzvkU&sensor=true">
    </script>
    <script type="text/javascript">

    //script partially taken from w3schools
    // and google maps api 

    var x; 
    var pos_lat;
    var pos_lng;
    var map;
    var marker;
    var form_lat;
    var form_lng;
      
    // use html5 geolocation to get the user's current location
    // and run showPosition if the position can be obtained
    function getLocation()
    {
      x = document.getElementById("demo");
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
      }
      else {
        x.innerHTML="Geolocation is not supported by this browser.";
      }
    }

    // display on the screen the coordinates
    function showPosition(position)
    {
      pos_lat = position.coords.latitude;
      pos_lng = position.coords.longitude;

      x.innerHTML="Latitude: " + position.coords.latitude + 
      "<br>Longitude: " + position.coords.longitude; 

      form_lat = document.getElementById('in_lat');
      form_lng = document.getElementById('in_lng');

      // set default values to be the user's current position
      form_lat.value = pos_lat;
      form_lng.value = pos_lng;
      initialize();
    }

    // initialize the map and the map marker
    function initialize() {
      var mapOptions = {
        center: new google.maps.LatLng(pos_lat, pos_lng),
        zoom: 18,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };

      map = new google.maps.Map(document.getElementById("map-canvas"),
              mapOptions);
      console.log('executed')
      // make a new marker and attach it at the user's location
      marker = new google.maps.Marker({
        position: mapOptions.center,
        map: map
      });


      // allows user to move marker
      google.maps.event.addListener(map, 'click', function(event) {
        placeMarker(event.latLng);
      });

    }

    // change the marker's position
    function placeMarker(location) {
      marker.setPosition(location)
      console.log("here: " + location + "  markerposition : " + marker.position );
      form_lat.value = location.lat();
      form_lng.value = location.lng();
      // map.setCenter(location);
    }
    
    window.onload = getLocation();

    </script>
  </body>
</html>
